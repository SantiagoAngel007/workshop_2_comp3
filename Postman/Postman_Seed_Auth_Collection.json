{
  "info": {
    "name": "Workshop 2 - Gym API (Con Auth Update Logic)",
    "description": "API para pruebas con nueva l√≥gica de autorizaci√≥n en UPDATE USER",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "üå± SEED",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/seed",
          "host": ["{{base_url}}"],
          "path": ["seed"]
        }
      }
    },
    {
      "name": "üîê AUTH - LOGIN",
      "item": [
        {
          "name": "Login - Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('admin_token', jsonData.token);",
                  "    pm.collectionVariables.set('admin_id', jsonData.id);",
                  "    console.log('‚úÖ Admin Token guardado');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "Login como admin - Guarda token en {{admin_token}}"
          }
        },
        {
          "name": "Login - Coach",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('coach_token', jsonData.token);",
                  "    pm.collectionVariables.set('coach_id', jsonData.id);",
                  "    console.log('‚úÖ Coach Token guardado');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"coach@example.com\",\n  \"password\": \"coach123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "Login como coach - Guarda token en {{coach_token}}"
          }
        },
        {
          "name": "Login - Client",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('client_token', jsonData.token);",
                  "    pm.collectionVariables.set('client_id', jsonData.id);",
                  "    console.log('‚úÖ Client Token guardado');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"client@example.com\",\n  \"password\": \"client123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "Login como client - Guarda token en {{client_token}}"
          }
        }
      ]
    },
    {
      "name": "‚úÖ CASOS EXITOSOS (POSITIVOS)",
      "item": [
        {
          "name": "‚úÖ Admin actualiza a otro usuario",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Coach Actualizado por Admin\",\n  \"age\": 29\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/{{coach_id}}",
              "host": ["{{base_url}}"],
              "path": ["auth", "{{coach_id}}"]
            },
            "description": "‚úÖ DEBE FUNCIONAR: Admin actualiza el perfil de coach"
          }
        },
        {
          "name": "‚úÖ Cliente actualiza su propio perfil",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{client_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Cliente Actualizado\",\n  \"age\": 26\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/{{client_id}}",
              "host": ["{{base_url}}"],
              "path": ["auth", "{{client_id}}"]
            },
            "description": "‚úÖ DEBE FUNCIONAR: Cliente actualiza su propio perfil"
          }
        },
        {
          "name": "‚úÖ Coach actualiza su propio perfil",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Coach Actualizado\",\n  \"age\": 29\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/{{coach_id}}",
              "host": ["{{base_url}}"],
              "path": ["auth", "{{coach_id}}"]
            },
            "description": "‚úÖ DEBE FUNCIONAR: Coach actualiza su propio perfil"
          }
        }
      ]
    },
    {
      "name": "‚ùå CASOS DE ERROR (NEGATIVOS)",
      "item": [
        {
          "name": "‚ùå Cliente intenta actualizar a otro usuario",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{client_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Hack Attempt\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/{{coach_id}}",
              "host": ["{{base_url}}"],
              "path": ["auth", "{{coach_id}}"]
            },
            "description": "‚ùå DEBE FALLAR: Cliente intenta actualizar el perfil de coach - Error 403 Forbidden"
          }
        },
        {
          "name": "‚ùå Coach intenta actualizar a otro usuario",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Hack Attempt\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/{{client_id}}",
              "host": ["{{base_url}}"],
              "path": ["auth", "{{client_id}}"]
            },
            "description": "‚ùå DEBE FALLAR: Coach intenta actualizar el perfil de cliente - Error 403 Forbidden"
          }
        },
        {
          "name": "‚ùå Sin autenticaci√≥n (Sin token)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Sin Token\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/{{client_id}}",
              "host": ["{{base_url}}"],
              "path": ["auth", "{{client_id}}"]
            },
            "description": "‚ùå DEBE FALLAR: Sin token de autenticaci√≥n - Error 401 Unauthorized"
          }
        },
        {
          "name": "‚ùå Token inv√°lido/expirado",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer invalid_token_12345",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Token Inv√°lido\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/{{client_id}}",
              "host": ["{{base_url}}"],
              "path": ["auth", "{{client_id}}"]
            },
            "description": "‚ùå DEBE FALLAR: Token inv√°lido - Error 401 Unauthorized"
          }
        },
        {
          "name": "‚ùå ID de usuario inexistente",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Usuario Inexistente\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/00000000-0000-0000-0000-000000000000",
              "host": ["{{base_url}}"],
              "path": ["auth", "00000000-0000-0000-0000-000000000000"]
            },
            "description": "‚ùå DEBE FALLAR: ID de usuario no existe - Error 404 Not Found"
          }
        }
      ]
    },
    {
      "name": "üìä VER USUARIOS Y DETALLES",
      "item": [
        {
          "name": "GET - Todos los usuarios",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/auth",
              "host": ["{{base_url}}"],
              "path": ["auth"]
            }
          }
        },
        {
          "name": "GET - Perfil de admin",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{admin_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/auth/{{admin_id}}",
              "host": ["{{base_url}}"],
              "path": ["auth", "{{admin_id}}"]
            }
          }
        },
        {
          "name": "GET - Perfil de coach",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{coach_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/auth/{{coach_id}}",
              "host": ["{{base_url}}"],
              "path": ["auth", "{{coach_id}}"]
            }
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "admin_token",
      "value": "",
      "type": "string",
      "description": "Token del admin"
    },
    {
      "key": "admin_id",
      "value": "",
      "type": "string",
      "description": "ID del admin"
    },
    {
      "key": "coach_token",
      "value": "",
      "type": "string",
      "description": "Token del coach"
    },
    {
      "key": "coach_id",
      "value": "",
      "type": "string",
      "description": "ID del coach"
    },
    {
      "key": "client_token",
      "value": "",
      "type": "string",
      "description": "Token del client"
    },
    {
      "key": "client_id",
      "value": "",
      "type": "string",
      "description": "ID del client"
    }
  ]
}